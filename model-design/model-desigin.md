# 模型设计

## 数据模型的三要素

- 实体
- 属性
- 关系

## 数据模型的三层深度

- 概念模型，逻辑模型，物理模型
- 一个模型逐步细化的过程

## 文档模型设计

### 分桶模型设计

| 场景 | 痛点 | 设计模式的方案及优点 |
| --- | --- | --- |
| 时序数据 物联网 智慧城市 智慧交通 | 数据点采集频繁, 数据量太多 | 利用文档内嵌数组, 将一个小时段的数据聚合到一个文档里. 大量减少文档数量.大量减少索引占用空间. |

### 列转行

```json
{
  "title": "Dunkirk",
  "release_USA": "2017/07/23",
  "release_UK": "2017/08/01",
  "release_France": "2017/08/01",
  "release_Festival_San_Jose": "2017/07/22"
}
```

优化后

```json
{
  "title": "Dunkirk",
  "releases":[
    { "country": "USA", "date": "2017/07/23" },
    { "country": "UK", "date": "2017/08/01" },
  ]
}
```

| 场景 | 痛点 | 设计模式的方案及优点 |
| --- | --- | --- |
| 产品属性 ‘color’, ‘size’, ‘dimensions’, ....多语言(多国家)属性 | 文档中有很多类似的字段会用于组合查询搜索，需要见很多索引 | 转化为数组，一个索引解决所有查询问题 |

### 版本字段

| 场景 | 痛点 | 设计模式的方案及优点 |
| --- | --- | --- |
| 任何有版本衍变的数据库 | 文档模型格式多，无法知道其合理性 升级时候需要更新太多文档 | 增加一个版本号字段 快速过滤掉不需要升级的文档 升级时候对不同版本的文档做 不同的处理 |


